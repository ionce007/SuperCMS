import{E as m,r as h,s as x,D as C,F as M,a as I,G as B,f as D,q as R}from"./element-plus.js";import{a as q,u as F}from"./vue-router.js";import{d as N,u as O}from"./slide.js";import{a as j}from"./upload.js";import{r as z,W as G,n as H,ab as K,c as L,o as d,O as o,L as l,K as P,H as S,a3 as T}from"./@vue.js";import"./dayjs.js";import"./@element-plus.js";import"./lodash-es.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./index.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./vanilla-jsoneditor.js";import"./json-source-map.js";import"./@jsonquerylang.js";import"./@fortawesome.js";import"./natural-compare-lite.js";import"./fast-deep-equal.js";import"./fast-uri.js";import"./jmespath.js";import"./jsonpath-plus.js";import"./@codemirror.js";import"./@lezer.js";import"./crelt.js";import"./@marijn.js";import"./style-mod.js";import"./w3c-keyname.js";import"./@replit.js";import"./immutable-json-patch.js";import"./jsonrepair.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */import"./sys_config.js";const W={class:"bg-fff pd-20 radius-6"},Re={__name:"edit",setup($){const f=q(),_=F(),p=z(null),t=G({id:0,title:"",imgUrl:"",linkUrl:""});H(async()=>{t.id=parseInt(f.params.id,10),await g()});async function g(){try{let e=await N(t.id);const{id:r,title:a,imgUrl:s,linkUrl:n}=e.data;e.code===200?Object.assign(t,{id:r,title:a,imgUrl:s,linkUrl:n}):m({message:e.msg,type:"error"})}catch(e){console.error(e)}}function y(e){return e.type.indexOf("image")===-1?(m("上传文件只能是图片格式"),!1):e.size/1024>10240?(m("上传图片必须小于10M"),!1):!0}async function U(e){const r=new FormData;r.append("file",e.file);try{let a=await j(r);a.code===200&&(t.imgUrl=a.data.path)}catch(a){console.error(a)}}async function b(){try{let e=await O(t);e.code==200?(m({message:"更新成功^_^",type:"success"}),_.go(-1)):m({message:e.msg,type:"error"})}catch(e){console.log(e)}}function v(){p.value.validate(e=>{if(e)b();else return console.log("error submit!!"),!1})}return(e,r)=>{const a=x,s=h,n=K("MostlyCloudy"),V=I,u=M,E=C,c=B,k=D,w=R;return d(),L("div",W,[o(w,{ref_key:"formRef",ref:p,model:t,"label-width":"84px",class:"mt-20"},{default:l(()=>[o(s,{label:"轮播标题",rules:[{required:!0,message:"请输入标题",trigger:"blur"}],prop:"title"},{default:l(()=>[o(a,{modelValue:t.title,"onUpdate:modelValue":r[0]||(r[0]=i=>t.title=i)},null,8,["modelValue"])]),_:1}),o(s,{class:"flex",label:"轮播图"},{default:l(()=>[o(E,{class:"avatar-uploader","http-request":U,"show-file-list":!1,"before-upload":y},{default:l(()=>[o(u,{placement:"top-start",title:"上传",width:200,trigger:"hover",content:"上传图片作为封面图，大小 10M 内"},{reference:l(()=>[o(V,{class:"avatar-uploader-icon"},{default:l(()=>[o(n)]),_:1})]),_:1})]),_:1}),t.imgUrl?(d(),P(u,{key:0,placement:"right",width:600,trigger:"hover"},{reference:l(()=>[o(c,{class:"avatar-uploader-icon pointer ml-10",src:t.imgUrl},null,8,["src"])]),default:l(()=>[o(c,{style:{width:"100%"},src:t.imgUrl},null,8,["src"])]),_:1})):S("",!0),o(a,{class:"ml-10 flex-1",modelValue:t.imgUrl,"onUpdate:modelValue":r[1]||(r[1]=i=>t.imgUrl=i)},null,8,["modelValue"])]),_:1}),o(s,{label:"轮播链接"},{default:l(()=>[o(a,{modelValue:t.linkUrl,"onUpdate:modelValue":r[2]||(r[2]=i=>t.linkUrl=i)},null,8,["modelValue"])]),_:1}),o(s,null,{default:l(()=>[o(k,{type:"primary",onClick:v},{default:l(()=>r[3]||(r[3]=[T("保存")])),_:1})]),_:1})]),_:1},8,["model"])])}}};export{Re as default};
