import{r as L,s as T,f as F,x as H,L as I,H as M,T as j,q as O,E as p}from"./element-plus.js";import{a as S,u as z}from"./vue-router.js";import{f as P}from"./category.js";import{d as A,g as G,u as K}from"./gather.js";import{_ as Q,d as W,a as J,t as X}from"./index.js";import{r as c,W as V,n as Y,c as Z,o as b,O as a,L as o,K as $,H as ee,a as n,a3 as d,Q as te}from"./@vue.js";import"./dayjs.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./vanilla-jsoneditor.js";import"./json-source-map.js";import"./@jsonquerylang.js";import"./@fortawesome.js";import"./natural-compare-lite.js";import"./fast-deep-equal.js";import"./fast-uri.js";import"./jmespath.js";import"./jsonpath-plus.js";import"./@codemirror.js";import"./@lezer.js";import"./crelt.js";import"./@marijn.js";import"./style-mod.js";import"./w3c-keyname.js";import"./@replit.js";import"./immutable-json-patch.js";import"./jsonrepair.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const ae={class:"mb-20 bg-fff pd-20"},re={class:"flex w-full"},oe={class:"flex w-full"},le={class:"f-15"},se=["innerHTML"],ie={__name:"edit",setup(ne){const v=S(),w=z(),f=c(null),r=V({id:v.params.id,taskName:"",targetUrl:"",parseData:"",status:"1",cid:1}),m=c([]),k={checkStrictly:!0},g=c([]),u=V({title:"",article:""});async function x(){try{let e=await P();if(e.code===200){let t=e.data,i=W(r.cid,t);m.value=i;let l=J(X(t));g.value=[...l]}}catch(e){console.log(e)}}function E(e){e.length&&e[e.length-1]!=-1&&(r.cid=e[e.length-1])}async function U(){try{let e=await A(r.id);e.code===200&&Object.assign(r,e.data)}catch(e){console.error(e)}}async function C(){try{let{targetUrl:e,parseData:t}=r,i=await G({targetUrl:e,parseData:t});i.code==200&&(Object.assign(u,i.data),p({message:"恭喜你，获取数据成功^_^",type:"success"}))}catch(e){console.log(e)}}async function N(){try{let e=await K(r);e.code==200?(p({message:"更新成功^_^",type:"success"}),w.go(-1)):p({message:e.msg,type:"error"})}catch(e){console.log(e)}}function D(){f.value.validate(e=>{if(e)N();else return!1})}return Y(async()=>{await U(),await x()}),(e,t)=>{const i=T,l=L,_=F,q=H,y=M,B=I,R=j,h=O;return b(),Z("div",ae,[a(h,{ref_key:"formRef",ref:f,model:r,"label-width":"84px"},{default:o(()=>[a(l,{label:"任务名称",prop:"taskName",rules:[{required:!0,message:"请输入任务名称",trigger:"blur"}]},{default:o(()=>[a(i,{modelValue:r.taskName,"onUpdate:modelValue":t[0]||(t[0]=s=>r.taskName=s),placeholder:"例：前端库-chat问答"},null,8,["modelValue"])]),_:1}),a(l,{label:"接口地址",prop:"targetUrl",rules:[{required:!0,message:"请输入匹配网址",trigger:"blur"}]},{default:o(()=>[n("div",re,[a(i,{class:"flex-1",modelValue:r.targetUrl,"onUpdate:modelValue":t[1]||(t[1]=s=>r.targetUrl=s)},null,8,["modelValue"])])]),_:1}),a(l,{label:"处理函数",prop:"parseData",rules:[{required:!0,message:"请输入内容字段",trigger:"blur"}]},{default:o(()=>[n("div",oe,[a(i,{class:"flex-1",type:"textarea",rows:13,modelValue:r.parseData,"onUpdate:modelValue":t[2]||(t[2]=s=>r.parseData=s),placeholder:"如果不做任何处理，直接返回data。拿到的文本是变量是data,可以直接js函数可以处理成需要的数据，最终需要返回data。例：\r\n            data.title = data.title;\r\n            data.article = data.data.news;\r\n            return data;\r\n            "},null,8,["modelValue"]),a(_,{class:"ml-5",type:"primary",onClick:C},{default:o(()=>t[5]||(t[5]=[d("测试")])),_:1})])]),_:1}),a(l,{label:"保存栏目",prop:"cid",rules:[{required:!0,message:"请输入保存栏目",trigger:"blur"}]},{default:o(()=>[a(q,{props:k,"show-all-levels":!1,modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=s=>m.value=s),options:g.value,onChange:E},null,8,["modelValue","options"])]),_:1}),a(l,{label:"发布状态",prop:"status",rules:[{required:!0,message:"请选择发布状态",trigger:"blur"}]},{default:o(()=>[a(B,{modelValue:r.status,"onUpdate:modelValue":t[4]||(t[4]=s=>r.status=s),class:"ml-4"},{default:o(()=>[a(y,{value:"1",size:"large"},{default:o(()=>t[6]||(t[6]=[d("草稿")])),_:1}),a(y,{value:"2",size:"large"},{default:o(()=>t[7]||(t[7]=[d("发布")])),_:1})]),_:1},8,["modelValue"])]),_:1}),u.title?(b(),$(l,{key:0,label:"采集结果"},{default:o(()=>[a(R,{class:"w-full",shadow:"never"},{header:o(()=>[n("p",le,[t[8]||(t[8]=n("span",{class:"c-999"},"标题：",-1)),d(te(u.title),1)])]),default:o(()=>[t[9]||(t[9]=n("p",{class:"f-15"},[n("span",{class:"c-999"},"内容：")],-1)),n("div",{class:"f-15 article",innerHTML:u.content},null,8,se)]),_:1})]),_:1})):ee("",!0),a(l,null,{default:o(()=>[a(_,{type:"primary",onClick:D},{default:o(()=>t[10]||(t[10]=[d("保存")])),_:1})]),_:1})]),_:1},8,["model"])])}}},Qe=Q(ie,[["__scopeId","data-v-c7680980"]]);export{Qe as default};
