import{f as N,w as R,O as j,P as H,Q as L,E as f}from"./element-plus.js";import{u as O}from"./vue-router.js";import{H as Q,E as U,I as V}from"./@element-plus.js";import{l as E,b as z,a as F}from"./collect.js";import{c as G}from"./article.js";import{f as W}from"./index.js";import{r as p,W as q,n as J,ab as K,c as X,o as Y,O as o,L as l,a3 as d,Q as y,u as h}from"./@vue.js";import"./dayjs.js";import"./lodash-es.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./vanilla-jsoneditor.js";import"./json-source-map.js";import"./@jsonquerylang.js";import"./@fortawesome.js";import"./natural-compare-lite.js";import"./fast-deep-equal.js";import"./fast-uri.js";import"./jmespath.js";import"./jsonpath-plus.js";import"./@codemirror.js";import"./@lezer.js";import"./crelt.js";import"./@marijn.js";import"./style-mod.js";import"./w3c-keyname.js";import"./@replit.js";import"./immutable-json-patch.js";import"./jsonrepair.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const Z={class:"bg-fff radius-6 pd-20"},Ht={__name:"index",setup(tt){const T=O(),x=p(null),v=p([]),S=p([]),b=p(0),w=p(1),n=p(0),i=q({cid:0,title:"",shortTitle:"",tagId:"",attr:[],source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用SuperCMS系统",status:"0",pv:1,link:""}),C=async()=>{try{const e=await E(w.value);e.code===200&&(v.value=[...e.data.list],b.value=e.data.count)}catch(e){console.log(e)}},A=e=>{w.value=e,E()},D=e=>{S.value=e},k=async e=>{try{const{pages:t,titleTag:a,articleTag:u,parseData:c,charset:s,cid:_,status:g}=e,r=t.split(","),m=await F({taskUrl:r[n.value],titleTag:a,articleTag:u,parseData:c,charset:s});if(m.code===200){const{title:P,article:M}=m.data;i.title=P,i.content=M,i.cid=_,i.status=g===1?1:0,$(i)}}catch(t){console.log(t)}},$=async e=>{try{const t={...i};t.attr=t.attr.toString(),t.tagId=t.tagId.toString(),!t.description&&t.content&&(t.description=W(t.content).substr(0,255));const a=await G({defaultParams:t,fieldParams:{}});a.code===200?(f({message:"第".concat(n.value+1,"条数据完成^_^"),type:"success"}),setTimeout(()=>{const{pages:u}=e,c=u.split(",");n.value<=c.length-1&&(k(e),n.value=n.value+1)},3e3)):f({message:a.msg||"第".concat(n.value+1,"条数据失败^_^"),type:"error"})}catch(t){console.log(t)}},B=e=>{const t=e.id;T.push({name:"collect-edit",params:{id:t}})},I=async e=>{const t=e.id;try{const a=await z(t);a.code===200?(f({message:"删除成功 ^_^",type:"success"}),C()):f({message:a.msg,type:"error"})}catch(a){console.log(a)}};return J(()=>{C()}),(e,t)=>{const a=N,u=K("router-link"),c=R,s=j,_=H,g=L;return Y(),X("div",Z,[o(c,{type:"flex",justify:"end"},{default:l(()=>[o(u,{to:"/collect/add"},{default:l(()=>[o(a,{type:"primary",round:""},{default:l(()=>t[0]||(t[0]=[d("新增")])),_:1})]),_:1})]),_:1}),o(_,{ref_key:"multipleTable",ref:x,data:v.value,"tooltip-effect":"dark","row-key":"id",onSelectionChange:D},{default:l(()=>[o(s,{type:"selection"}),o(s,{prop:"id",width:"60",label:"编号"}),o(s,{prop:"taskName",label:"任务名称"}),o(s,{prop:"category",label:"所属栏目"}),o(s,{prop:"charset",label:"编码"},{default:l(r=>[d(y(r.row.charset===1?"UTF-8":"GB2312"),1)]),_:1}),o(s,{prop:"status",label:"状态"},{default:l(r=>[d(y(r.row.status===1?"草稿":"发布"),1)]),_:1}),o(s,{prop:"updatedAt",label:"发布时间"},{default:l(r=>[d(y(r.row.updatedAt),1)]),_:1}),o(s,{fixed:"right",width:"222",label:"操作"},{default:l(r=>[o(a,{icon:h(Q),circle:"",onClick:m=>B(r.row)},null,8,["icon","onClick"]),o(a,{icon:h(U),circle:"",onClick:m=>I(r.row)},null,8,["icon","onClick"]),o(a,{type:"primary",round:"",icon:h(V),onClick:m=>k(r.row)},{default:l(()=>t[1]||(t[1]=[d("执行")])),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"]),o(c,{type:"flex",class:"mt-20 align-c",justify:"center"},{default:l(()=>[o(g,{background:"",layout:"prev, pager, next",onCurrentChange:A,"page-size":10,total:b.value,"hide-on-single-page":""},null,8,["total"])]),_:1})])}}};export{Ht as default};
