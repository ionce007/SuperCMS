import{n as $e,m as qe,w as Ge,u as He,r as Je,x as ze,s as Ke,y as Ze,A as he,B as We,C as Qe,D as Xe,F as Ye,a as el,G as ll,f as al,o as tl,H as ol,I as sl,J as ul,K as rl,L as nl,M as dl,q as il,E as b}from"./element-plus.js";import{W as ue,r as i,n as ml,ab as A,c as V,o as d,a as y,O as l,L as t,K as c,H as F,T as N,a3 as _,I as k,ac as U,U as O,u as pl}from"./@vue.js";import{u as cl}from"./vue-router.js";import{f as fl}from"./category.js";import{f as vl,d as _l,c as gl}from"./article.js";import{s as Vl}from"./tag.js";import{v as bl}from"./sys_config.js";import{t as yl,_ as wl}from"./tinymce.js";import{D as kl}from"./DialogCroper.js";import{u as Ul,a as M}from"./upload.js";import{_ as Cl,a as re,t as El,b as xl,c as Il,f as Dl}from"./index.js";import"./dayjs.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./vue-cropper.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./vanilla-jsoneditor.js";import"./json-source-map.js";import"./@jsonquerylang.js";import"./@fortawesome.js";import"./natural-compare-lite.js";import"./fast-deep-equal.js";import"./fast-uri.js";import"./jmespath.js";import"./jsonpath-plus.js";import"./@codemirror.js";import"./@lezer.js";import"./crelt.js";import"./@marijn.js";import"./style-mod.js";import"./w3c-keyname.js";import"./@replit.js";import"./immutable-json-patch.js";import"./jsonrepair.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const jl={class:"bg-fff pd-10 radius-6"},Al={class:"mr-10 ml-10"},Sl={class:"mr-10 ml-10 mb-20"},Pl={class:"cover row"},Ll={class:"cover flex align-center"},Rl={class:"imgs-btn"},Tl={__name:"add",setup(Bl){const ne=cl(),$=ue({...yl}),q=i(!0),G=i([-1]),de={checkStrictly:!0},H=i("first"),E=i("0"),J=i([]),ie=i([]),S=i([]),P=i(!1),L=i(!1),z=i(1),K=i([]),x=i(),Z=i(),h=i(),W=i(""),s=ue({cid:0,title:"",shortTitle:"",tagId:"",attr:[],articleView:"",source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用SuperCMS系统",status:"0",pv:1,link:""}),g=i([]),Q=i(""),R=i(!1),me=i(1),T=i(!1),pe=i(["/public/cover/01.jpg","/public/cover/02.jpg","/public/cover/03.jpg","/public/cover/04.jpg","/public/cover/05.jpg","/public/cover/06.jpg","/public/cover/07.jpg","/public/cover/08.jpg","/public/cover/09.jpg","/public/cover/10.jpg"]),ce=async()=>{try{const o=await bl();o.code===200&&(S.value=o.data.filter(e=>!["404.html","500.html"].includes(e)).map(e=>({label:e,value:e})),console.log(S.value))}catch(o){console.error(o)}},X=async o=>{try{const e=await Vl(me.value,o);e.code===200&&e.data&&(K.value=e.data.list.map(u=>({label:u.name,value:u.id})))}catch(e){console.error(e)}},fe=async()=>{try{const o=await fl();if(o.code===200){const e=re(El(o.data)),u=re(o.data);ie.value=u,J.value=[...e]}}catch(o){console.error(o)}},ve=o=>{o[0]!==-1?(s.cid=o[o.length-1],_e(s.cid)):g.value=[]},_e=async o=>{try{const e=await vl(o);e.code===200&&(e.data.fields.forEach(u=>{if(u.default&&u.default.includes("[{")&&u.default.includes("options")){const p=JSON.parse(u.default);u.default=p.options||[]}u.type==="8"&&(u.values=[])}),g.value=e.data.fields)}catch(e){console.error(e)}},ge=()=>{q.value=!1},Ve=o=>{s.img=o},be=o=>{E.value=o.index},ye=o=>{if(o.type.indexOf("image")===-1)return b({message:"上传文件只能是图片格式",type:"success"}),!1;x.value=o;const e=new FileReader;return e.onload=async u=>{let p;typeof u.target.result=="object"?p=window.URL.createObjectURL(new Blob([u.target.result])):p=u.target.result,W.value=p,Z.value.dialogFormVisible=!0},e.readAsArrayBuffer(o),!0},we=async()=>{if(x.value.size/1024/1024>.2)return b({message:"上传图片必须小于200k",type:"success"}),!1;const o=new FormData;o.append("file",x.value);const e=await M(o);e.code===200&&(s.img=e.data.path)},ke=o=>{if(o.type.indexOf("image")===-1)return b({message:"上传文件只能是图片格式",type:"success"}),!1;if(o.size/1024/1024>.2)return b({message:"上传图片必须小于200k",type:"success"}),!1},Ue=async o=>{const{data:{index:e},file:u}=o,p=new FormData;p.append("file",u);const f=await M(p);if(f.code===200){const{filename:r,path:m}=f.data;Array.isArray(g.value[e].values)?g.value[e].values.push({name:r,url:m}):g.value[e].values=[{name:r,url:m}]}},Ce=async o=>{Q.value=o.url,R.value=!0},Ee=async o=>{g.value.forEach((e,u)=>{Array.isArray(e.values)&&e.values.forEach((p,f)=>{p.url===o.url&&(xe(o.url),e.values.splice(f,1))})})},xe=async o=>{try{await _l(o)}catch(e){console.error(e)}},Ie=async()=>{try{const o={...s};o.attr=s.attr.toString(),o.tagId=s.tagId.toString(),!s.img&&P.value&&(s.img=Il(s.content)[0]),!s.description&&L.value&&(s.description=Dl(s.content).substr(0,255));const e=g.value.reduce((p,f)=>(p[f.ename]=Array.isArray(f.values)?JSON.stringify(f.values):f.values,p),{}),u=await gl({defaultParams:o,fieldParams:e});u.code===200?(b({message:"更新成功^_^",type:"success"}),ne.go(-1)):b({message:u.msg,type:"error"})}catch(o){console.error(o)}},De=async o=>{o&&await o.validate((e,u)=>{if(e){if(s.cid===0){b({message:"请选择栏目^_^",type:"success"});return}Ie()}else xl(u)})};return ml(async()=>{$.images_upload_url=await Ul(),await fe(),await X(),await ce()}),(o,e)=>{const u=$e,p=qe,f=ze,r=Je,m=He,v=Ke,je=Ze,w=We,Ae=he,Y=Qe,Se=A("MostlyCloudy"),I=el,ee=Ye,le=Xe,C=ll,ae=al,Pe=tl,D=Ge,B=ol,te=rl,oe=ul,Le=nl,Re=A("ZoomIn"),Te=A("Delete"),Be=dl,Fe=A("Plus"),Ne=il,Oe=sl;return d(),V("div",jl,[y("div",Al,[l(p,{modelValue:H.value,"onUpdate:modelValue":e[0]||(e[0]=a=>H.value=a),onTabClick:be},{default:t(()=>[l(u,{label:"基本信息",name:"first"}),l(u,{label:"扩展信息",name:"second"}),g.value.length>0?(d(),c(u,{key:0,label:"模型信息",name:"three"})):F("",!0)]),_:1},8,["modelValue"])]),y("div",Sl,[l(Ne,{ref_key:"paramsRef",ref:h,model:s,"label-width":"90px"},{default:t(()=>[N((d(),V("div",null,[l(D,{gutter:20},{default:t(()=>[l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"文章栏目"},{default:t(()=>[l(f,{props:de,"show-all-levels":!1,modelValue:G.value,"onUpdate:modelValue":e[1]||(e[1]=a=>G.value=a),options:J.value,onChange:ve},null,8,["modelValue","options"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"文章标题",prop:"title",rules:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:100,message:"标题不能超过100个字",trigger:"blur"}]},{default:t(()=>[l(v,{modelValue:s.title,"onUpdate:modelValue":e[2]||(e[2]=a=>s.title=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"tag标签"},{default:t(()=>[l(je,{modelValue:s.tagId,"onUpdate:modelValue":e[3]||(e[3]=a=>s.tagId=a),options:K.value,placeholder:"请选择标签",style:{width:"240px"},multiple:"",filterable:"",remote:"","remote-method":X},null,8,["modelValue","options"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"内容属性"},{default:t(()=>[l(Ae,{modelValue:s.attr,"onUpdate:modelValue":e[4]||(e[4]=a=>s.attr=a)},{default:t(()=>[l(w,{label:"1",value:"1"},{default:t(()=>e[24]||(e[24]=[_("头条")])),_:1}),l(w,{label:"2",value:"2"},{default:t(()=>e[25]||(e[25]=[_("推荐")])),_:1}),l(w,{label:"3",value:"3"},{default:t(()=>e[26]||(e[26]=[_("轮播")])),_:1}),l(w,{label:"4",value:"4"},{default:t(()=>e[27]||(e[27]=[_("热门")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"发布时间"},{default:t(()=>[l(Y,{modelValue:s.createdAt,"onUpdate:modelValue":e[5]||(e[5]=a=>s.createdAt=a),"default-value":new Date,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","default-value"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{class:"flex",label:"缩略图"},{default:t(()=>[l(le,{class:"avatar-uploader","http-request":we,"show-file-list":!1,"before-upload":ye},{default:t(()=>[l(ee,{placement:"top-start",title:"上传",width:200,trigger:"hover",content:"上传图片作为封面图，大小200k内"},{reference:t(()=>[l(I,{class:"avatar-uploader-icon"},{default:t(()=>[l(Se)]),_:1})]),_:1})]),_:1}),s.img?(d(),c(ee,{key:0,placement:"right",width:400,trigger:"hover"},{reference:t(()=>[l(C,{class:"avatar-uploader-icon pointer ml-10",src:s.img},null,8,["src"])]),default:t(()=>[l(C,{style:{width:"100%"},src:s.img},null,8,["src"])]),_:1})):F("",!0),l(ae,{type:"primary",class:"ml-10",onClick:e[6]||(e[6]=a=>T.value=!0)},{default:t(()=>e[28]||(e[28]=[_(" 默认封面图 ")])),_:1}),l(Pe,{modelValue:T.value,"onUpdate:modelValue":e[7]||(e[7]=a=>T.value=a),title:"默认封面图",class:"w-300","with-header":!1},{default:t(()=>[y("div",Pl,[(d(!0),V(k,null,U(pe.value,(a,j)=>(d(),c(C,{key:j,src:a,onClick:n=>Ve(a),fit:"cover"},null,8,["src","onClick"]))),128))])]),_:1},8,["modelValue"]),l(v,{class:"ml-10 flex-1",modelValue:s.img,"onUpdate:modelValue":e[8]||(e[8]=a=>s.img=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"内容摘要"},{default:t(()=>[l(v,{type:"textarea",rows:2,placeholder:"请输入内容",modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=a=>s.description=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"文章内容"},{default:t(()=>[l(wl,{modelValue:s.content,"onUpdate:modelValue":e[10]||(e[10]=a=>s.content=a),setting:$,onInit:ge,"script-src":"/public/admin/tinymce/tinymce.min.js"},null,8,["modelValue","setting"])]),_:1}),l(D,{gutter:20},{default:t(()=>[l(m,{sm:24,md:12,lg:8},{default:t(()=>[l(r,{label:"自动封面"},{default:t(()=>[l(w,{modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=a=>P.value=a)},{default:t(()=>[e[29]||(e[29]=_(" 文章第 ")),l(v,{modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=a=>z.value=a),class:"w-80 mr-8 ml-8",placeholder:"请输入内容"},null,8,["modelValue"]),e[30]||(e[30]=_("张图 "))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12,lg:8},{default:t(()=>[l(r,{label:"提取描述"},{default:t(()=>[l(w,{modelValue:L.value,"onUpdate:modelValue":e[13]||(e[13]=a=>L.value=a)},{default:t(()=>e[31]||(e[31]=[_("提取文章描述")])),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12,lg:8},{default:t(()=>[l(r,{label:"是否显示"},{default:t(()=>[l(B,{modelValue:s.status,"onUpdate:modelValue":e[14]||(e[14]=a=>s.status=a),value:"0"},{default:t(()=>e[32]||(e[32]=[_("发布")])),_:1},8,["modelValue"]),l(B,{modelValue:s.status,"onUpdate:modelValue":e[15]||(e[15]=a=>s.status=a),value:"1"},{default:t(()=>e[33]||(e[33]=[_("不发布")])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])),[[O,E.value==0],[Oe,q.value]]),N(y("div",null,[l(D,{gutter:20},{default:t(()=>[l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"短标题",prop:"name"},{default:t(()=>[l(v,{modelValue:s.shortTitle,"onUpdate:modelValue":e[16]||(e[16]=a=>s.shortTitle=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"内容模板"},{default:t(()=>[l(oe,{modelValue:s.articleView,"onUpdate:modelValue":e[17]||(e[17]=a=>s.articleView=a),placeholder:"请选择模板"},{default:t(()=>[(d(!0),V(k,null,U(S.value,a=>(d(),c(te,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"来源"},{default:t(()=>[l(v,{modelValue:s.source,"onUpdate:modelValue":e[18]||(e[18]=a=>s.source=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"作者"},{default:t(()=>[l(v,{modelValue:s.author,"onUpdate:modelValue":e[19]||(e[19]=a=>s.author=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"外链跳转"},{default:t(()=>[l(v,{modelValue:s.link,"onUpdate:modelValue":e[20]||(e[20]=a=>s.link=a),max:"120"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(r,{label:"浏览数"},{default:t(()=>[l(v,{modelValue:s.pv,"onUpdate:modelValue":e[21]||(e[21]=a=>s.pv=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})],512),[[O,E.value==1]]),N(y("div",null,[l(D,{gutter:20},{default:t(()=>[(d(!0),V(k,null,U(g.value,(a,j)=>(d(),c(m,{key:j,sm:24,md:24,lg:24},{default:t(()=>[["1","7"].includes(a.type)?(d(),c(r,{key:0,label:a.cname},{default:t(()=>[l(v,{modelValue:a.values,"onUpdate:modelValue":n=>a.values=n,max:"120"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["2","9"].includes(a.type)?(d(),c(r,{key:1,label:a.cname},{default:t(()=>[l(v,{type:"textarea",rows:4,placeholder:"请输入内容",modelValue:a.values,"onUpdate:modelValue":n=>a.values=n},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["4"].includes(a.type)?(d(),c(r,{key:2,label:a.cname},{default:t(()=>[l(Le,{modelValue:a.values,"onUpdate:modelValue":n=>a.values=n},{default:t(()=>[(d(!0),V(k,null,U(a.defaultVal,n=>(d(),c(B,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["3","5"].includes(a.type)?(d(),c(r,{key:3,label:a.cname},{default:t(()=>[l(oe,{modelValue:a.values,"onUpdate:modelValue":n=>a.values=n,placeholder:"请选择"},{default:t(()=>[(d(!0),V(k,null,U(a.defaultVal,n=>(d(),c(te,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):a.type==="6"?(d(),c(r,{key:4,label:a.cname},{default:t(()=>[l(Y,{modelValue:a.values,"onUpdate:modelValue":n=>a.values=n,"default-value":new Date,type:"datetime",placeholder:"请选择"},null,8,["modelValue","onUpdate:modelValue","default-value"])]),_:2},1032,["label"])):a.type==="8"?(d(),c(r,{key:5,label:a.cname,class:"flex align-c justify-center"},{default:t(()=>[y("div",Ll,[(d(!0),V(k,null,U(a.values,(n,se)=>(d(),V("div",{class:"pos-r img-item",key:se},[(d(),c(C,{key:se,src:n.url,fit:"cover"},null,8,["src"])),y("div",Rl,[l(I,{onClick:Me=>Ce(n)},{default:t(()=>[l(Re)]),_:2},1032,["onClick"]),l(I,{onClick:Me=>Ee(n)},{default:t(()=>[l(Te)]),_:2},1032,["onClick"])])]))),128))]),l(Be,{modelValue:R.value,"onUpdate:modelValue":e[22]||(e[22]=n=>R.value=n)},{default:t(()=>[l(C,{"w-full":"",src:Q.value,alt:"Preview Image"},null,8,["src"])]),_:1},8,["modelValue"]),l(le,{multiple:"","http-request":Ue,data:{...a,index:j},"before-upload":ke,limit:10,"show-file-list":!1},{default:t(()=>[l(I,{class:"upload-icon"},{default:t(()=>[l(Fe)]),_:1})]),_:2},1032,["data"])]),_:2},1032,["label"])):F("",!0)]),_:2},1024))),128))]),_:1})],512),[[O,E.value==2&g.value.length>0]]),l(r,null,{default:t(()=>[l(ae,{type:"primary",onClick:e[23]||(e[23]=a=>De(h.value))},{default:t(()=>e[34]||(e[34]=[_("保存")])),_:1})]),_:1})]),_:1},8,["model"])]),l(kl,{ref_key:"dialogCrop",ref:Z,img:W.value,file:x.value,onCrop:pl(M)},null,8,["img","file","onCrop"])])}}},Ia=Cl(Tl,[["__scopeId","data-v-32122d4d"]]);export{Ia as default};
