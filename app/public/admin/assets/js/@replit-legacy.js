System.register(["./@codemirror-legacy.js"],(function(t,e){"use strict";var i,n,s,r,o,c,l;return{setters:[t=>{i=t.F,n=t.V,s=t.c,r=t.E,o=t.g,c=t.R,l=t.D}],execute:function(){function e(t){const e=t.selection.main.head;return t.doc.lineAt(e)}function h(t,e){let i=0;t:for(let n=0;n<t.length;n++)switch(t[n]){case" ":case"Â ":i+=1;continue t;case"\t":i+=e-i%e;continue t;case"\r":continue t;default:break t}return i}t("i",(function(t={}){return[a.of(t),d(t.colors),n.fromClass(v,{decorations:t=>t.decorations})]}));const a=i.define({combine:t=>s(t,{highlightActiveBlock:!0,hideFirstIndent:!1,markerType:"fullScope",thickness:1})});class u{constructor(t,e,i,n){this.lines=t,this.state=e,this.map=new Map,this.unitWidth=i,this.markerType=n;for(const s of this.lines)this.add(s);this.state.facet(a).highlightActiveBlock&&this.findAndSetActiveLines()}has(t){return this.map.has("number"==typeof t?t:t.number)}get(t){const e=this.map.get("number"==typeof t?t:t.number);if(!e)throw new Error("Line not found in indentation map");return e}set(t,e,i){const n=!t.text.trim().length,s={line:t,col:e,level:i,empty:n};return this.map.set(s.line.number,s),s}add(t){if(this.has(t))return this.get(t);if(!t.length||!t.text.trim().length){if(1===t.number)return this.set(t,0,0);if(t.number===this.state.doc.lines){const e=this.closestNonEmpty(t,-1);return this.set(t,0,e.level)}const e=this.closestNonEmpty(t,-1),i=this.closestNonEmpty(t,1);return e.level>=i.level&&"codeOnly"!==this.markerType?this.set(t,0,e.level):e.empty&&0===e.level&&0!==i.level?this.set(t,0,0):i.level>e.level?this.set(t,0,e.level+1):this.set(t,0,i.level)}const e=h(t.text,this.state.tabSize),i=Math.floor(e/this.unitWidth);return this.set(t,e,i)}closestNonEmpty(t,e){let i=t.number+e;for(;-1===e?i>=1:i<=this.state.doc.lines;){if(this.has(i)){const t=this.get(i);if(!t.empty)return t}const t=this.state.doc.line(i);if(t.text.trim().length){const e=h(t.text,this.state.tabSize),i=Math.floor(e/this.unitWidth);return this.set(t,e,i)}i+=e}const n=this.state.doc.line(-1===e?1:this.state.doc.lines);return this.set(n,0,0)}findAndSetActiveLines(){const t=e(this.state);if(!this.has(t))return;let i,n,s=this.get(t);if(this.has(s.line.number+1)){const t=this.get(s.line.number+1);t.level>s.level&&(s=t)}if(this.has(s.line.number-1)){const t=this.get(s.line.number-1);t.level>s.level&&(s=t)}if(0!==s.level){for(s.active=s.level,i=s.line.number;i>1;i--){if(!this.has(i-1))continue;const t=this.get(i-1);if(t.level<s.level)break;t.active=s.level}for(n=s.line.number;n<this.state.doc.lines;n++){if(!this.has(n+1))continue;const t=this.get(n+1);if(t.level<s.level)break;t.active=s.level}}}}function d(t){const e={light:"#F0F1F2",dark:"#2B3245",activeLight:"#E4E5E6",activeDark:"#3C445C"};let i=e;return t&&(i=Object.assign(Object.assign({},e),t)),r.baseTheme({"&light":{"--indent-marker-bg-color":i.light,"--indent-marker-active-bg-color":i.activeLight},"&dark":{"--indent-marker-bg-color":i.dark,"--indent-marker-active-bg-color":i.activeDark},".cm-line":{position:"relative"},".cm-indent-markers::before":{content:'""',position:"absolute",top:0,left:"2px",right:0,bottom:0,background:"var(--indent-markers)",pointerEvents:"none",zIndex:"-1"}})}function m(t,e,i,n,s){return`repeating-linear-gradient(to right, var(${t}) 0 ${e}px, transparent ${e}px ${i}ch) ${n*i}.5ch/calc(${i*s}ch - 1px) no-repeat`}function f(t,e,i,n,s){const{level:r,active:o}=t;if(s=null!=s?s:n,i&&0===r)return[];const c=i?1:0,l=[];if(void 0!==o){const t=o-c-1;t>0&&l.push(m("--indent-marker-bg-color",n,e,c,t)),l.push(m("--indent-marker-active-bg-color",s,e,o-1,1)),o!==r&&l.push(m("--indent-marker-bg-color",n,e,o,r-o))}else l.push(m("--indent-marker-bg-color",n,e,c,r-c));return l.join(",")}class v{constructor(t){this.view=t,this.unitWidth=o(t.state),this.currentLineNumber=e(t.state).number,this.generate(t.state)}update(t){const i=o(t.state),n=i!==this.unitWidth;n&&(this.unitWidth=i);const s=e(t.state).number,r=s!==this.currentLineNumber;this.currentLineNumber=s;const c=t.state.facet(a).highlightActiveBlock&&r;(t.docChanged||t.viewportChanged||n||c)&&this.generate(t.state)}generate(t){const e=new c,i=function(t,e=t.state){const i=new Set;for(const{from:n,to:s}of t.visibleRanges){let t=n;for(;t<=s;){const n=e.doc.lineAt(t);i.has(n)||i.add(n),t=n.to+1}}return i}(this.view,t),{hideFirstIndent:n,markerType:s,thickness:r,activeThickness:o}=t.facet(a),h=new u(i,t,this.unitWidth,s);for(const c of i){const t=h.get(c.number);if(!(null==t?void 0:t.level))continue;const i=f(t,this.unitWidth,n,r,o);e.add(c.from,c.from,l.line({class:"cm-indent-markers",attributes:{style:`--indent-markers: ${i}`}}))}this.decorations=e.finish()}}}}}));
