<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="description"content="{{site.description}}">
    <meta name="keywords" content="{{site.keywords}}"/>
    <meta property="og:title" content="{{site.title}}" />
    <meta property="og:description" content="{{site.description}}" />
    <title>{{site.title}}-基于大数据的股票交易策略</title>
    {{include './common/meta.html'}}
    <link rel="stylesheet" href="{{static_url}}/css/flatpickr.min.css" />
    <link rel="stylesheet" href="{{static_url}}/css/font-awesome.all.min.css" />
    <link rel="stylesheet" href="{{static_url}}/css/stock.css" />
    <script src="{{static_url}}/js/chart.js"></script>
    <script src="{{static_url}}/js/stockChart.js"></script>
    <script src="{{static_url}}/js/stock.js"></script>
</head>
<body class="bg-f8f8f8" id="app">
    <!-- 头部 -->
    {{include './common/header.html'}}
    
    <!-- banner -->
    <!--<section class="banner flex justify-center">
        <h3 class="chanyue text-c">缠说・股经</h3>
        <p class="f-20 text-c mt-20">基于大数据的股票交易策略</p>
    </section>-->

    <!--<section class="main center flex justify-between flex-wrap pd-30" id="app">-->
        <div class="limit-tab-container">
            <h1 class="page-title timeline-title-w100">涨停追踪</h1>
            <!-- 页签导航 -->
            <div class="tabpane use-for-sticky">
                <div class="concept-date text-align-center">
                    <button class="btn limit-trade-date fl-ml-5 pt-5" @click="getQueryTradeDate('PREV')" id="btnPrev">< 上一日 </button>
                    <div class="limit-trade-date date-picker">
                        <input type="text" id="tdate" readonly>
                        <span class="calendar-icon"></span>
                    </div>
                    <button class="btn limit-trade-date fr-mr-5 pt-5" @click="getQueryTradeDate('NEXT')" id="btnNext"> 下一日 > </button>
                </div>

                <div class="tabs-header">
                    <div class="tabs-scroll-wrapper">
                        <!-- 左箭头 -->
                        <div class="nav-arrow left hidden" id="arrow-left"><i class="fas fa-chevron-left"></i></div>
                        <!-- 页签滚动容器 -->
                        <div class="tabs-scroll-container">
                            <div class="tabs" id="tabs">
                                <div class="tab tab-tag ml-0 active" data-tab="tab1" data-src="limitSumary">涨停概览</div>
                                <div class="tab tab-tag" data-tab="tab2" data-src="marketEmotion">市场情绪</div>
                                <div class="tab tab-tag" data-tab="tab3" data-src="strongBlock">强势板块</div>
                                <div class="tab tab-tag" data-tab="tab4" data-src="limitCause">涨停揭秘</div>
                                <div class="tab tab-tag" data-tab="tab5" data-src="continuousLimitUp">连板天梯</div>
                                <div class="tab tab-tag" data-tab="tab6" data-src="limitMutli">多板个股</div>
                            </div>
                        </div>
                        <!-- 右箭头 -->
                        <div class="nav-arrow right" id="arrow-right"><i class="fas fa-chevron-right"></i></div>
                    </div>
                </div>
            </div>
            <!-- 页签内容 -->
            <div class="tab-content" id="mainTabContent">
                <!-- 第一个页签：  涨停全览-->
                <div id="tab1" class="tab-pane tab-data-container active">
                    <div class="limit-data-list" id="upLimitSummary">
                        <div class="limit-money-efffect">
                            <div class="limit-data-item no-border">
                                <div class="item-content mt-15 mh-60 pd-10-5 flex-fdr">
                                    <div class="theme-title ">
                                        <span class="theme-name">赚钱效应</span>
                                    </div>
                                    <div class="effect-span"><img src="/web/default/img/strong.png" style="width:40px;height:40px;" class="effect-img"></div>
                                </div>
                                <div class="pl-5 pb-20 ft-16">建议仓位为 <span class="position-suggestion"></span></div>
                            </div>
                            <div class="limit-data-item no-border">
                                <div class="" style="min-width:80px;min-height:80px;">
                                    <canvas width="120" height="120" class="dashboard-1" id="moneyEffect"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="limit-data-item no-border" style="display:block">
                            <div class="swiper-container">
                                <div class="swiper-wrapper"></div>
                                <div class="swiper-pagination"></div>
                            </div>
                        </div>
                    </div>
                    <div class="theme-pane">
                        <h3 class="timeline-title">涨停龙头</h3>
                        <div class="limitupdown-data-list" id="limitUpLeaderStock"></div>
                    </div>

                    <div class="theme-pane">
                        <h3 class="timeline-title">涨停监测</h3>
                        <div class="limit-tab-container">
                            <div class="tabpane ml-1 mr-1">
                                <div class="tabs-header">
                                    <div class="tabs-scroll-wrapper">
                                        <!-- 左箭头 -->
                                        <div class="nav-arrow left left-15 hidden" id="monitor-arrow-left">
                                            <i class="fas fa-chevron-left"></i>
                                        </div>
                                        <!-- 页签滚动容器 -->
                                        <div class="tabs-scroll-container">
                                            <div class="tabs" id="monitor-tabs">
                                                <div class="tab-monitor tab-tag ml-0 tab-font active" data-tab="monitortab1" data-src="auction">竞价涨停</div>
                                                <div class="tab-monitor tab-tag tab-font" data-tab="monitortab2" data-src="limitnatural">涨停池</div>
                                                <div class="tab-monitor tab-tag tab-font" data-tab="monitortab3" data-src="limitsoon">即将涨停</div>
                                                <div class="tab-monitor tab-tag tab-font" data-tab="monitortab4" data-src="limitdays">连板池</div>
                                                <div class="tab-monitor tab-tag tab-font" data-tab="monitortab5" data-src="touchlimit">炸板池</div>
                                                <div class="tab-monitor tab-tag tab-font" data-tab="monitortab6" data-src="prelimit">昨日涨停</div>
                                                <div class="tab-monitor tab-tag tab-font" data-tab="monitortab7" data-src="declinelimited">跌停池</div>
                                                <div class="tab-monitor tab-tag tab-font" data-tab="monitortab8" data-src="touchlimitdown">曾跌停</div>
                                            </div>
                                        </div>
                                
                                        <!-- 右箭头 -->
                                        <div class="nav-arrow right right-15" id="monitor-arrow-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-content ml-1 mr-1" id="limitContent">
                                <div id="monitortab1" class="tab-pane-monitor tab-data-container active">
                                    <div class="table-container" id="auctionList"></div>
                                </div>
                                <div id="monitortab2" class="tab-pane-monitor tab-data-container">
                                    <div class="table-container" id="limitnaturalList"></div>
                                </div>
                                <div id="monitortab3" class="tab-pane-monitor tab-data-container">
                                    <div class="table-container" id="limitsoonList"></div>
                                </div>
                                <div id="monitortab4" class="tab-pane-monitor tab-data-container">
                                    <div class="table-container" id="limitdaysList"></div>
                                </div>
                                <div id="monitortab5" class="tab-pane-monitor tab-data-container">
                                    <div class="table-container" id="touchlimitList"></div>
                                </div>
                                <div id="monitortab6" class="tab-pane-monitor tab-data-container">
                                    <div class="table-container" id="prelimitList"></div>
                                </div>
                                <div id="monitortab7" class="tab-pane-monitor tab-data-container">
                                    <div class="table-container" id="declinelimitedList"></div>
                                </div>
                                <div id="monitortab8" class="tab-pane-monitor tab-data-container">
                                    <div class="table-container" id="touchlimitdownList"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="theme-pane">
                        <h3 class="timeline-title">涨停伏击</h3>
                        <div class="limit-tab-container">
                            <div class="tabpane ml-1 mr-1">
                                <div class="tabs-header">
                                    <div class="tabs-scroll-wrapper">
                                        <!-- 页签滚动容器 -->
                                        <div class="tabs-scroll-container">
                                            <div class="limit-tab-nav" id="quality-tabs">
                                                <button class="tab-btn-quality tab-tag tab-font active" data-tab="qualitytab1" data-src="quality">优质基因</button>
                                                <button class="tab-btn-quality tab-tag tab-font" data-tab="qualitytab2" data-src="limitsprint">涨停冲刺</button>
                                                <button class="tab-btn-quality tab-tag tab-font" data-tab="qualitytab3" data-src="limitregulars">涨停常客</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-content ml-1 mr-1" id="qualityContent">
                                <div id="qualitytab1" class="tab-pane-quality tab-data-container active">
                                    <div class="table-container" id="qualityList"></div>
                                </div>
                                <div id="qualitytab2" class="tab-pane-quality tab-data-container">
                                    <div class="table-container" id="limitsprintList"></div>
                                </div>
                                <div id="qualitytab3" class="tab-pane-quality">
                                    <div class="table-container" id="limitregularsList"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 第二个页签： 市场情绪-->
                <div id="tab2" class="tab-pane tab-data-container">
                    <div class="theme-pane">
                        <div class="limit-market-emotion">
                            <div class="limit-data-item mb-10">
                                <div class="limit-tab-container">
                                    <div class="tabpane ml-1 mr-1">
                                        <div class="tabs-header">
                                            <div class="tabs-scroll-wrapper">
                                                <!-- 页签滚动容器 -->
                                                <div class="tabs-scroll-container">
                                                    <div class="limit-tab-nav" id="funds0-tabs">
                                                        <h3 class="timeline-title market-emotion ml-10 mt-10">市场情绪</h3>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-content ml-1 mr-1" id="fundsContent">
                                        <div class="chart-container" id="emotionChartContainer"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="limit-data-item mb-10">
                                <div class="limit-tab-container">
                                    <div class="tabpane ml-1 mr-1">
                                        <div class="tabs-header">
                                            <div class="tabs-scroll-wrapper">
                                                <!-- 页签滚动容器 -->
                                                <div class="tabs-scroll-container">
                                                    <div class="limit-tab-nav" id="funds-tabs">
                                                        <h3 class="timeline-title market-emotion ml-10 mt-10">市场资金</h3>
                                                        <button class="tab-btn-quality tab-tag tab-font active" data-tab="marginbalanceList" data-src="marginbalance">融资融券</button>
                                                        <button class="tab-btn-quality tab-tag tab-font" data-tab="toptraderList" data-src="toptrader">龙虎榜</button>
                                                        <button class="tab-btn-quality tab-tag tab-font" data-tab="liftlockupList" data-src="liftlockup">限售解禁</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-content ml-1 mr-1" id="fundsContent">
                                        <div class="chart-container tab-pane-quality tab-data-container active" id="marginbalanceList"></div>
                                        <div class="chart-container tab-pane-quality tab-data-container" id="toptraderList"></div>
                                        <div class="chart-container tab-pane-quality tab-data-container" id="liftlockupList"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="theme-pane">
                        <div class="limit-market-emotion">
                            <div class="limit-data-item mb-10">
                                <h3 class="timeline-title limit-trend ml-10 mt-10">涨跌停走势<span>{{ currDate }}</span></h3>
                                <div class="chart-container" id="limitChartContainer"></div>
                            </div>
                            <div class="limit-data-item mb-10">
                                <h3 class="timeline-title prelimit-action ml-10 mt-10">“昨日涨停”板块今日表现</h3>
                                <div class="chart-container" id="prelimitBlkChartContainer"></div>
                            </div>
                        </div>
                    </div>
                </div>
        
                <!-- 第三个页签： 强势板块 -->
                <div id="tab3" class="tab-pane tab-data-container">
                    <div class="strong-data-container">
                        <div class='no-auction-data nodisplay' id="nodataContainer">暂无数据</div>
                        <div class="sector-list" id="sectorList"></div>
                    </div>
                </div>

                <!-- 第四个页签： 涨停揭秘 -->
                <div id="tab4" class="tab-pane tab-data-container">
                    <div class="tabs-header mb-10 pb-10">
                        <div class="tabs-scroll-wrapper">
                            <div class="nav-arrow left left-15 hidden" id="limitCause-arrow-left"><i class="fas fa-chevron-left"></i></div>
                            <div class="tabs-scroll-container">
                                <div class="tabs" id="limitCause-tabs"></div>
                            </div>
                            <div class="nav-arrow right right-15" id="limitCause-arrow-right"><i class="fas fa-chevron-right"></i></div>
                        </div>
                    </div>
                    <div class="strong-data-container">
                        <div class='no-auction-data nodisplay' id="nodataCause">暂无数据</div>
                        <div class="sector-list" id="limitCauseList"></div>
                    </div>
                </div>

                <!-- 第五个页签： 连板天梯 -->
                <div id="tab5" class="tab-pane tab-data-container">
                    <div class="theme-pane">
                        <div class="tabs-header mb-10">
                            <div class="tabs-scroll-wrapper">
                                <div class="tabs-scroll-container">
                                    <div class="limit-tab-nav" id="ladder-tabs">
                                        <button class="tab-btn-ladder tab-tag tab-font active" data-tab="laddertab1" data-src="limitladder">连板天梯</button>
                                        <button class="tab-btn-ladder tab-tag tab-font" data-tab="laddertab2" data-src="conlimitstat">连板统计</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-content ml-1 mr-1" id="ladderContent">
                            <div class='no-auction-data nodisplay' id="nodataLadder">暂无数据</div>
                            <div id="laddertab1" class="tab-pane-monitor tab-data-container active">
                                <div class="table-container" id="limitladderList"></div>
                            </div>
                            <div id="laddertab2" class="tab-pane-monitor tab-data-container">
                                <div class="contilimit-stat-card" id="continuousLimitList"></div>
                            </div>
                        </div>
                        <!--<div class='no-auction-data nodisplay' id="nodataLadder">暂无数据</div>
                        <div class="limit-ladder-list" id="limitladderList"></div>-->
                    </div>
                </div>

                <!-- 第六个页签： 多板个股 -->
                <div id="tab6" class="tab-pane tab-data-container">
                    <div class="table-container" id="limitmutliList">

                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal-overlay" id="modalOverlay"></div>
        
        <div class="modal-dialog" id="modalDialog">
            <div class="modal-header">
                <h3 class="modal-title">上榜原因</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-content">
                    <h4 id="modalItemTitle"></h4>
                    <div id="modalItemDesc"></div>
                </div>
            </div>
            <div class="modal-footer"><button class="modal-action-btn close">关闭</button></div>
        </div>
    <!--</section>-->

    {{include './common/footer.html'}}
    <!-- 移动端导航 -->
    {{include './common/wap-nav.html'}}
    <div class="ignore mb-20 mt-20 pd-20 bg-f2f2f2">
        <!--<p class="mb-20">MoneyEffect-> {{MoneyEffect}} </p>-->
    </div>
    {{include './common/js.html'}}
    <script src="{{static_url}}/js/flatpickr.js"></script>
    <script src="{{static_url}}/js/vue.global.prod.js"></script>
    <script src="{{static_url}}/js/tailwindcss.so.js"></script>
    
    <!--<script src="https://3.swiper.com.cn/dist/js/swiper.min.js"></script>-->
</body>
    <script type="text/javascript">
        var swiper = null;
        const app = Vue.createApp({
            data() {
                return {
                    calendar: null,
                    allowDates: JSON.parse(decodeHtmlEntities(`{{ allTradeDate }}`)),
                    tradeDate: '',
                    currDate: '',
                    blockPageNumber: 1,
                    blockPageSize: 6,
                    blockIsLoading: false,
                    blockPageCount: 0,
                    causePageNumber: 1,
                    causePageSize: 30,
                    causeIsLoading: false,
                    causePageCount: 0,
                    moneyMakingEffect: JSON.parse(decodeHtmlEntities(`{{ MoneyEffect }}`)),
                    limitUpLeaderData: JSON.parse(decodeHtmlEntities(`{{ limitUpLeader }}`)),
                    auctionLimitUpData: JSON.parse(decodeHtmlEntities(`{{ auctionLimitUp }}`)),
                    highQualityData: JSON.parse(decodeHtmlEntities(`{{ hightQualityLimitUp }}`)),
                }
            },
            setup(){
            },
            created() {
                if(this.allowDates){
                    this.tradeDate = this.allowDates[0];
                    this.currDate = this.tradeDate;
                }
                this.initPage();
            },
            updated(){
                this.setPrevNextButtonDisableState();
            },
            watch: {
                currDate:{
                    async handler(newVal){
                        if(!newVal) return;
                        this.blockPageNumber = 1;
                        this.blockPageCount = 0;
                        this.blockIsLoading = false;
                        this.causePageNumber = 1;
                        this.causePageCount = 0;
                        this.causeIsLoading = false;
                        this.setPrevNextButtonDisableState(newVal);
                        await this.renderTabData();
                    },
                    immediate: false
                },
            },
            computed: {
                getCurrDate() { return this.currDate;}
            },
            methods: {
                async initPage(){
                    const data = await this.getCalendar();
                    this.allowDates = data.result.data.map(item => { return item.DATE.substring(0, 10); })
                    this.tradeDate = this.allowDates[0];
                    this.initCancenlar();
                    this.monitorTabClick();
                },
                async getCalendar() {
                    const url = `/api/d/limitCalendar`
                    const res = await fetch(url, { method: "GET", headers: { 'Content-Type': 'application/json' } });
                    const data = await res.json();
                    return data;
                },
                setPrevNextButtonDisableState(date){
                    document.querySelectorAll('button.limit-trade-date').forEach(item => item.classList.remove('disabled'));
                    if (!date || date === this.tradeDate) {
                        document.getElementById('btnNext').classList.add('disabled')
                    }
                    if (date === this.allowDates[this.allowDates.length - 1]) {
                        document.getElementById('btnPrev').classList.add('disabled')
                    }
                },
                initCancenlar() {
                    let that = this;
                    this.calendar = flatpickr("#tdate", {
                        dateFormat: "Y-m-d",
                        locale: 'zh',
                        allowInput: false,
                        disableMobile: true,
                        clickOpens: true,
                        onReady: function () {
                            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                                //this._input.removeAttribute("readonly");
                            }
                        },
                        defaultDate: that.allowDates[0],
                        //disable: function(date) { return allowDates.indexOf(date)<0; },
                        onOpen: function (selectedDates, dateStr, instance) {
                            document.getElementById('tdate').readonly = true;
                            //console.log('onOpen --> this.allowDates = ', _allowDates[0])
                            disableNotAllowDates(that.allowDates);
                        },
                        onMonthChange: function (selectedDates, dateStr, instance) { disableNotAllowDates(that.allowDates); },
                        onYearChange: function (selectedDates, dateStr, instance) { disableNotAllowDates(that.allowDates); },
                        onClose: function (dateObject, dateString) {
                            //console.log(' dateObject = ', dateObject)
                            //console.log(' dateString = ', dateString)
                        },
                        onChange: function (data, date) {
                            that.currDate = date;
                            console.log('that.currDate = ', that.currDate)
                            /*let index = that.allowDates.indexOf(date);
                            that.nextDate = (index === 0 ? '' : that.allowDates[index - 1]);
                            that.prevDate = (index === that.allowDates.length - 1 ? '' : that.allowDates[index + 1]);*/
                        }
                    });
                },
                monitorTabClick(){
                    if(this.StrongBlockScroll) window.removeEventListener("scroll", this.StrongBlockScroll)
                    document.querySelectorAll('.tab-tag').forEach(tab => {
                        const that = this;
                        tab.addEventListener('click', async function(event){
                            if (event.target.classList.contains('active')) return;
                             await that.fillData(event.target);
                        });
                    })
                },
                async fillData(tabEl) {
                    if (!tabEl) return;
                    const reportName = tabEl.getAttribute('data-src').toLowerCase();
                    if (!reportName || reportName === '') return;
                    
                    switch(reportName){
                        case 'limitsumary':
                        case 'marketemotion':
                        case 'strongblock':
                        case 'limitcause':
                        case "conlimitstat":
                        case "limitladder":
                            await this.renderTabData(reportName);
                            break;
                        case 'continuouslimitup':
                            const activeBtn = document.querySelector('button.tab-btn-ladder.active');
                            const report = activeBtn.getAttribute('data-src');
                            await this.renderTabData(report);
                            break;
                        default:
                            const data = await this.getReportData(reportName);
                            renderLimitReport(reportName, data);
                            break;
                    }
                    
                    let queryEls = `#${tabEl.parentElement.id} > .tab-tag`;
                    document.querySelectorAll(queryEls).forEach(tab => { tab.classList.remove('active') });
                    tabEl.classList.add('active');
                    const tabId = tabEl.getAttribute('data-tab');
                    queryEls = `#${document.getElementById(tabId).parentElement.id} > .tab-data-container`;
                    document.querySelectorAll(queryEls).forEach(pane => pane.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                },
                renderMoneyMakingeffect(){
                    if(!document.querySelector('.swiper-wrapper')) return;
                    const html = renderMoneyMakingeffectHtml(this.moneyMakingEffect);
                    document.querySelector('.swiper-wrapper').innerHTML = html;
                    if(swiper) swiper.destroy();
                    swiper = new Swiper('.swiper-container', {
                        pagination: { el: '.swiper-pagination', clickable: true },
                        slidesPerView: 3,
                        //spaceBetween: 30,
                        paginationClickable: true,
                        centeredSlides: false,
                        spaceBetween: 0
                    });
                },
                renderLimitUpLeader() {
                    if(!document.getElementById('limitUpLeaderStock')) return;
                    const html = renderLimitUpLeaderHtml(this.limitUpLeaderData);
                    document.getElementById('limitUpLeaderStock').innerHTML = html;
                },
                renderAuctionLimitUp() {
                    renderLimitReport('auction', this.auctionLimitUpData);
                },
                renderHighQualityStock(){
                    renderLimitReport('quality', this.highQualityData);
                },
                async getReportData(report, pn = -1, ps = -1, bc = ''){
                    let url = bc ? `/api/d/report/${report}/${bc}/?date=${this.currDate}` : `/api/d/report/${report}/?date=${this.currDate}`
                    url = pn > 0 && ps > 0 ? `${url}&pn=${pn}&ps=${ps}` : url;
                    const res = await fetch(url, { method: "GET", headers: { 'Content-Type': 'application/json' } });
                    const data = await res.json();
                    return data;
                },
                async loadStrongBlockData(reportName){
                    if(this.blockPageNumber === 1) document.getElementById('sectorList').innerHTML = "";
                    const res = await this.getReportData(reportName, this.blockPageNumber, this.blockPageSize);
                    if(!res || res.code !== 0 || !res.result || !res.result.data || res.result.data.length === 0)
                    { 
                        document.getElementById('nodataContainer').classList.remove('nodisplay');
                        document.getElementById('sectorList').classList.remove('nodisplay');
                        document.getElementById('sectorList').classList.add('nodisplay');
                        return;
                    }
                    let html = '';
                    const sectorData = res.result.data;
                    this.blockPageCount = res.result.pages;
                    this.blockIsLoading = true;
                    try{
                        for(const item of sectorData){
                            html += `                            <div class="sector-item active">
                                <div class="sector-header">
                                    <div class="sector-name">${item.BOARD_NAME}</div>
                                    <div class="days-on-list">${item.BOARD_YILD}%</div>
                                </div>
                                <div class="sector-stats pb-10">
                                    <div class="stat-item">
                                        <div class="stat-label">涨停家数</div>
                                        <div class="stat-value limit-up">${item.HLIMITE_NUM}家</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">连板家数</div>
                                        <div class="stat-value continuous-board">${item?.CONLIMITE_NUM ? item.CONLIMITE_NUM : '--'}家</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">龙头高度</div>
                                        <div class="stat-value leader-height">${item.STOCK_HIGH}</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">上榜天数</div>
                                        <div class="stat-value leader-height">${item.LIST_DAYS}</div>
                                    </div>
                                </div>
                                ${ await this.getStrongBlockStockHtml(item)}
                            </div>`;
                            //document.getElementById('sectorList').innerHTML += html;
                        }
                        document.getElementById('sectorList').innerHTML += html;
                    }
                    catch(error){}
                    finally{
                        this.blockIsLoading = false;
                    }
                },
                async getStrongBlockStockHtml(block){
                    let stockList = [];
                    if(block.hasOwnProperty('LIMIT_UP_LIST')) stockList = block.LIMIT_UP_LIST
                    else {
                        const blockStock = await this.getReportData('strongstock', -1, -1, block.DRIVE_BOARD_CODE);
                        stockList = blockStock && blockStock.result && blockStock.result.data ? blockStock.result.data : stockList;
                    }
                    let html = '';
                    if(stockList && stockList.length > 0){
                        let itemHtml = '';
                        for(const item of stockList){
                            itemHtml += `                                    <div class="stock-item">
                                        <div class="stock-name">${item.SECURITY_NAME_ABBR}</div>
                                        <div class="stock-price">${item.NEWEST_PRICE}</div>
                                        <div class="stock-change">${item.YIELD.toFixed(2)}%</div>
                                        <div class="stock-time">${item.CLOSE_LIMITUP_TIME}</div>
                                    </div>`
                        }
                        html = `                                <div class="stock-list mobile-stock-list pt-10 stock-active">
                                    <div class="stock-item">
                                        <div class="stock-header">股票名称</div>
                                        <div class="stock-header">最新价</div>
                                        <div class="stock-header">涨幅</div>
                                        <div class="stock-header">封板时间</div>
                                    </div>
                                    ${itemHtml}
                                </div>
                            `
                    }
                    return html;
                },
                StrongBlockScroll(){
                    if(!this.blockIsLoading && this.blockPageNumber < this.blockPageCount && isScrolledToBottom()){
                        this.blockPageNumber++;
                        this.loadStrongBlockData('strongblock')
                    }
                },
                async LimitCauseScroll(){
                    if(!this.causeIsLoading && this.causePageNumber < this.causePageCount && isScrolledToBottom()){
                        this.causePageNumber++;
                        this.renderLimitCause()
                    }
                },
                async renderLimitCauseBlock(){
                    const blockData = await this.getReportData('limitupblock');
                    if(blockData && blockData.result && blockData.result.data && blockData.result.data.length > 0){
                        renderLimitCauseBlockData(blockData);
                        const that = this;
                        document.querySelectorAll('.limit-cause-list').forEach(item => {
                            item.addEventListener('click', async function(){
                                const blockCode = this.getAttribute('data-src');
                                document.querySelectorAll('.limit-cause-list.active').forEach(el => { el.classList.remove('active')});
                                this.classList.add('active');
                                this.causePageNumber = 1;
                                that.renderLimitCause(blockCode);
                            })
                        })
                    }
                },
                async renderLimitCause(block = ''){
                    this.causeIsLoading = true;
                    const reportName = block ? 'causeblock' : 'limitcause'
                    const causeData = await this.getReportData(reportName, this.causePageNumber, this.causePageSize, block)
                    if(causeData && causeData.result) this.causePageCount = causeData.result.pages;
                    this.causeIsLoading = renderLimitCauseData(causeData, this.causePageNumber);
                    if(this.causePageCount > 0 ) {
                        showModalDialog();
                        window.addEventListener('scroll', this.LimitCauseScroll);
                    }
                },
                async getQueryTradeDate(prev_next){
                    if(!this.allowDates || this.allowDates.length === 0){
                        const url = `/api/d/limitCalendar`
                        const res = await fetch(url, { method: "GET", headers: { 'Content-Type': 'application/json' } });
                        const data = await res.json();
                        this.allowDates = data.result.data.map(item => { return item.DATE.substring(0, 10); })
                    }
                    this.tradeDate = this.allowDates[0];
                    let newDate = !this.currDate ? this.tradeDate : this.currDate;
                    const currDateIndex = this.allowDates.indexOf(newDate);
                    if(prev_next === 'PREV'){
                        if(currDateIndex < this.allowDates.length - 1) { 
                            newDate = this.allowDates[currDateIndex + 1];
                            this.calendar.setDate(new Date(newDate));
                            this.currDate = newDate;
                        }
                    }
                    if (prev_next === 'NEXT') {
                        if (currDateIndex > 0) {
                            newDate = this.allowDates[currDateIndex - 1];
                            this.calendar.setDate(new Date(newDate));
                            this.currDate = newDate;
                        }
                    }
                },
                async getApiResults(reports){
                    try{
                        const promises = reports.map( async (report, index) => {
                            try{
                                const url = `/api/d/report/${report}/?date=${this.currDate}`
                                const response = await fetch(url);
                                if (!response.ok) {
                                    console.log(`HTTP ${response.status}`);
                                    return { status: 'error', report: report, data: null, index: index, message: `${report}请求失败。`};
                                }
                                const data = await response.json();
                                return { status: 'fulfilled', report: report, data: data, index: index, message: `${report}请求成功。`};
                            }
                            catch(error){
                                console.log(`请求出错：`, error);
                                return { status: 'rejected', report: report, data: null, index: index, message: `${report}访问出错：${error.message}。`};
                            }
                        });
                        const results = await Promise.all(promises);
                        await this.renderPromiseData(results);
                    }
                    catch(error){
                        console.log(`执行请求出错：`, error);
                    }
                },
                async renderPromiseData(results){
                    results.sort((a, b) => a.index - b.index);
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            results.forEach(result => {
                                this.displayReport(result.data, result.report, result.message);
                            });
                        }, 0);
                    });
                },
                displayReport(data, report, message){
                    let html = `<div class='no-auction-data'>暂无数据</div>`;
                    switch(report){
                        case 'effect':
                            this.moneyMakingEffect = data;
                            this.renderMoneyMakingeffect();
                            break;
                        case 'limitleader':
                            this.limitUpLeaderData = data
                            this.renderLimitUpLeader();
                            break;
                        case 'marketemotion':
                            drawMarketEmotionChart(data);
                            break;
                        case 'limittrend':
                            drawLimitupTrends(data, this.tradeDate === this.currDate)
                            break;
                        case 'prelimitaction':
                            drawPrelimitActionChart(data, this.tradeDate === this.currDate)
                            break;
                        case 'marginbalance':
                            const marginChart = new marginBalanceChart(`${report}List`, data.result.data);
                            break;
                        case 'toptrader':
                            const topTraderChart = new topTraderRankingChart(`${report}List`, data.result.data);
                            break;
                        case 'liftlockup':
                            drawLiftLockupFundsChart(report, data);
                            break;
                        default:
                            renderLimitReport(report, data);
                            break;
                    }
                },
                async renderTabData(tabName){
                    if(!tabName) {
                        const tabEl = document.querySelector('#tabs > .active');
                        if(!tabEl) return;
                        tabName = tabEl.getAttribute('data-src').toLowerCase();
                        if(!tabName || tabName === '') return;
                    }
                    let reports = [];
                    switch(tabName){
                        case 'limitsumary':
                            const activeMonitorEl = document.querySelector('#monitor-tabs > .active');
                            const activeQualityEl = document.querySelector('#quality-tabs > .active');
                            reports = ['limitleader', 'effect', activeMonitorEl.getAttribute('data-src').toLowerCase(), activeQualityEl.getAttribute('data-src').toLowerCase()]
                            this.getApiResults(reports);
                            break;
                        case 'marketemotion':
                            const fundsTab = document.querySelector('#funds-tabs > .active');
                            reports = ['marketemotion', 'limittrend', 'prelimitaction', fundsTab.getAttribute('data-src').toLowerCase()]
                            this.getApiResults(reports);
                            break;
                        case 'strongblock':
                            this.blockPageNumber = 1;
                            this.loadStrongBlockData(tabName);
                            window.addEventListener('scroll', this.StrongBlockScroll);
                            break;
                        case 'limitcause':
                            this.causePageNumber = 1;
                            this.renderLimitCauseBlock();
                            tabs = document.getElementById('limitCause-tabs');
                            tabs.scrollTo({left: 0,behavior: 'smooth'});
                            this.renderLimitCause();
                            break;
                        case 'continuouslimitup':
                            const activeBtn = document.querySelector('button.tab-btn-ladder.active');
                            const report = activeBtn.getAttribute('data-src');
                            await this.renderTabData(report);
                            break;
                        case 'limitladder':
                            const ladderData = await this.getReportData(tabName);
                            renderLimitLadderData(ladderData);
                            break;
                        case 'conlimitstat':
                            const contiData = await this.getReportData(tabName);
                            let sourceData = null;
                            let isRealtime = this.tradeDate === this.currDate;
                            renderContinueLimitData(contiData, isRealtime);
                            break;
                        case 'limitmutli':
                            const mutliData = await this.getReportData(tabName);
                            renderLimitReport(tabName, mutliData);
                            break;
                    }
                },
            },
            mounted(){
                if(this.moneyMakingEffect) this.renderMoneyMakingeffect();
                if(this.limitUpLeaderData) this.renderLimitUpLeader();
                if(this.auctionLimitUpData) this.renderAuctionLimitUp();
                if(this.highQualityData) this.renderHighQualityStock();

                this.setPrevNextButtonDisableState(this.currDate);
                //this.getCalendar();
            },
            unmounted(){

            }
        });
        app.mount("#app");
        
        function decodeHtmlEntities(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            return doc.documentElement.textContent;
        }
        function disableNotAllowDates(allowDates) {
            //if(!allowDates || allowDates.length === 0 ) return false;
            const dates = document.querySelectorAll('.flatpickr-day');
            dates.forEach(item => {
                const dateS = item.getAttribute('aria-label');
                const dateArr = dateS.replace('月', ',').split(',');
                const date = formatDate(new Date(parseInt(dateArr[2]), parseInt(dateArr[0]) - 1, parseInt(dateArr[1])), 'yyyy-MM-dd').trim();
                if (allowDates.indexOf(date) < 0) { item.setAttribute('aria-disabled', 'true');}
            })
        }

        flatpickr.l10ns.zh = {
            weekdays: {
                shorthand: ["周日", "周一", "周二", "周三", "周四", "周五", "周六"],
                longhand: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"]
            },
            months: {
                shorthand: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],
                longhand: ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"]
            },
            rangeSeparator: " 至 ",
            weekAbbreviation: "周",
            scrollTitle: "滚动切换",
            toggleTitle: "点击切换 12/24 小时时制"
        };
        
        function scrollTabs(tabs, arrowLeft, arrowRight, tabPanes) {
            // 每次滚动的距离
            const scrollAmount = 200;
            // 更新箭头状态
            function updateArrowState() {
                const scrollLeft = tabs.scrollLeft;
                const maxScrollLeft = tabs.scrollWidth - tabs.clientWidth;
                // 向左箭头状态
                if (scrollLeft <= 10) arrowLeft.classList.add('hidden');
                else arrowLeft.classList.remove('hidden');
                // 向右箭头状态
                if (scrollLeft >= maxScrollLeft - 10) arrowRight.classList.add('hidden');
                else arrowRight.classList.remove('hidden');
            }
            // 初始更新箭头状态
            updateArrowState();
            // 向右滚动
            arrowRight.addEventListener('click', function () {
                if (!this.classList.contains('hidden')) {
                    tabs.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                    // 滚动完成后更新箭头状态
                    setTimeout(updateArrowState, 300);
                }
            });
            // 向左滚动
            arrowLeft.addEventListener('click', function () {
                if (!this.classList.contains('hidden')) {
                    tabs.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                    // 滚动完成后更新箭头状态
                    setTimeout(updateArrowState, 300);
                }
            });
            // 监听滚动事件更新箭头状态
            tabs.addEventListener('scroll', updateArrowState);
            // 添加调整窗口大小时更新状态
            window.addEventListener('resize', updateArrowState);
        }
        document.addEventListener('DOMContentLoaded', function () {
            let tabs = document.getElementById('tabs');
            let arrowLeft = document.getElementById('arrow-left');
            let arrowRight = document.getElementById('arrow-right');
            let tabPanes = document.querySelectorAll('.tab-pane');
            scrollTabs(tabs, arrowLeft, arrowRight, tabPanes);

            tabs = document.getElementById('monitor-tabs');
            arrowLeft = document.getElementById('monitor-arrow-left');
            arrowRight = document.getElementById('monitor-arrow-right');
            tabPanes = document.querySelectorAll('.tab-pane-monitor');
            scrollTabs(tabs, arrowLeft, arrowRight, tabPanes);

            tabs = document.getElementById('limitCause-tabs');
            arrowLeft = document.getElementById('limitCause-arrow-left');
            arrowRight = document.getElementById('limitCause-arrow-right');
            scrollTabs(tabs, arrowLeft, arrowRight);
        });
        document.querySelector('.ico-open').addEventListener('click', function () {
            document.querySelector('.m-mask').classList.remove("none")
        })
        document.querySelector('.m-mask').addEventListener('click', function () {
            this.classList.add("none")
        })
    </script>

</html>